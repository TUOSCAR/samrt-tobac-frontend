# 智慧烟田系统开发方案

## 一、项目概述
本项目旨在基于 Django 5 和 Vue 3 开发一个智慧烟田系统，整合各类烟田相关数据，提供基础分析工具、大模型综合智慧分析与决策支持，实现监测任务管理、决策执行与反馈，以及数据的可视化与交互，同时具备完善的用户权限管理功能。

## 二、系统功能模块

### 1. 数据管理模块
#### 1.1 原始数据管理
- **传感器数据**
  - **数据 1：无人机多光谱影像**：通过手动上传的方式获取，用于后续的烟株计数、长势分析等。
- **气象数据**
  - **数据 2：气象预报数据**：调用第三方 API 实时获取，包括温度、降水量等。
  - **数据 3：气象实时数据**：调用第三方 API 实时获取，包含空气温湿度、降水量、光照信息。
- **烟叶业务数据**  
  - **数据 6：烟叶种植合同面积**：由用户手动录入，是估产分析的重要依据。
  - **数据 7：留叶数范围**：由用户手动录入，辅助估产分析。
  - **数据 8：单叶干重范围**：由用户手动录入，用于估产分析。
  - **数据 9：烟田地块边界矢量数据**：手动上传，包含所属烟农、分管烟技人员、面积等属性信息，为各类分析提供基础地理信息。
- **数据分类存储**
  - **一级分类**：按时间（年 - 月 - 日）进行细化，便于数据的时间维度管理。
  - **二级分类**：分为传感器数据和业务数据，清晰区分不同类型的数据。
  - **三级分类**：按种植周期（如移栽期、旺长期、打顶期、成熟采收期等）或监测任务（如"3月长势监测任务"）划分，方便根据不同阶段和任务进行数据检索和分析。

#### 1.2 知识库与文档管理
- **文档上传与分类和管理**  
  - 支持上传多种格式的种植技术文档，包括 word、PDF、图片、视频等。
  - 文档分类明确，如生产技术指南、病虫害防治指南、施肥标准、政策文件、生长模型文档等。
  - 提供文件删除、关键词搜索和标签管理功能，方便用户快速查找和管理文档。
- **知识库构建**  
  - 调用第三方API（如dify或COZE API）实现知识库的创建和删除，创建时的参数为选中的已经上传的文档

### 2. 基础分析工具模块 
- **烟株计数**
  - **输入**：无人机多光谱影像（数据 1）和烟田地块边界矢量数据（数据 9）和监测任务ID。
  - **输出**：整张影像中的烟株矢量点（geojson格式），烟田ID，每块烟田的烟株数量和密度，监测任务ID。
  - **说明**：目前先搭建输入输出模型，具体计算过程后续开发。
- **长势分析**
  - **输入**：无人机多光谱影像（数据 1）、烟田地块边界矢量数据（数据 9）和监测任务ID。
  - **输出**：长势分级图（tif格式）、烟田ID，每块烟田的不同等级长势面积占比，监测任务ID。
  - **说明**：目前先搭建输入输出模型，具体计算过程后续开发。
- **估产分析**
  - **输入**：烟叶种植合同面积（数据 6）、留叶数范围（数据 7）、单叶干重范围（数据 8）、烟田地块边界矢量数据（数据 9）、烟田ID，每块烟田的烟株数量和密度、每块烟田的不同等级长势面积占比、监测任务ID。
  - **输出**：烟田ID、每个地块的产量估算值、监测任务ID。
  - **说明**：目前先搭建输入输出模型，具体计算过程后续开发。

### 3. 大模型综合智慧分析与决策模块
- **功能概述**：根据基础分析结果，调用第三方烟叶种植智能 API（如dify或COZE API）作为决策支持系统的智能中枢，对每块烟田内部烟叶的种植情况进行深入分析，实现以下六个方面的功能:
  - **参数优化**
    - 基于海量历史数据和实时信息，动态校准基础分析中的部分参数，如长势分级阈值、单叶干重等。
  - **异常诊断**
    - 快速识别和分析烟叶生长过程中的异常情况，结合多因素关联分析，找出导致异常的原因，如气象因素、不当农事操作等，为及时采取针对性管理措施提供依据。
  - **策略推演**
    - 根据本次监测结果，为种植者提供动态的最优种植决策建议，制定决策执行任务，并指出上一次决策任务执行存在的问题。
  - **监测任务制定**
    - 在决策执行任务完成后，根据决策任务执行情况和历史监测分析结果，制定下次监测任务。
  - **报告生成**
    - 将复杂的异常诊断、策略推演和监测任务制定结果以清晰、直观的方式呈现，生成详细报告，方便种植者、管理者和相关部门进行沟通和决策。
  - **智能体对话窗口**
    - 提供一个智能对话窗口，用户可以在其中与系统进行自然语言交互，获取本项目相关数据信息和决策建议。

### 4. 监测任务管理模块
#### 监测任务管理（细化到地块）
- **监测任务创建**
  - 由大模型综合智慧分析与决策模块中的任务制定功能确定监测任务的时间和内容。
  - 管理员根据实际情况决定是否创建该监测任务。
- **任务进度跟踪**
  - 实时跟踪监测任务的执行进度，包括基础分析完成情况、大模型综合智慧分析与决策结果、决策执行情况。
- **任务结果管理**
  - 管理监测任务的最终结果，包括存储分析结果、报告、决策建议等。

#### 农事管理记录（细化到地块）
- 以日历的形式管理每次农事操作，农事操作包括移栽、除草、施肥、打顶、采收等。
- 记录各个农事操作的细节，并细化到每个烟田地块。
- 将农事操作关联到决策执行任务与反馈模块中的执行反馈，区分常规农事操作和由决策任务下发后执行的农事操作，在日历视图中用不同颜色区分。
- 将监测任务的时间和内容关联到日历视图上，方便用户查看和管理。

### 5. 决策执行任务与反馈模块
#### 5.1 任务下发与跟踪
- **决策执行任务分配**  
  - 根据烟田归属属性自动分配烟农、烟技人员执行任务。
  - 根据每个烟田的策略推演和报告生成结果安排任务，任务类型包括施肥、病虫害防治、灌溉等。
- **移动端通知**  
  - 通过短信推送任务详情，包括地图定位、烟田编号、任务详情等。（暂不考虑移动APP）
- **执行反馈**  
  - 烟技人员根据烟农的执行枪口上传执行结果，如照片、完成时间、完成度、具体操作等。（还是在web系统上操作）

### 6. 可视化与交互模块
- **地图可视化**  
  - 集成 GIS 地图（Leaflet），展示数据 1 - 3、数据 9 以及基础分析结果（烟株计数、长势分析、估产分析）。
  - 在地图上可点击查看每个地块对应的不同监测任务的大模型综合智慧分析与决策、执行情况等。
  - 支持时间轴对比功能，可在不同监测任务之间、不同年月日之间进行对比，用户可选择对比维度，如对比长势变化等。
- **数据图表**  
  - 以表格的形式展示和管理每个烟田地块，每次监测任务展示其基础分析完成情况、大模型综合智慧分析与决策、执行情况等。
  - 以图表形式展示历次分析结果的统计信息，以及相关指标的变化情况。

### 7. 系统支持与扩展模块
#### 7.1 用户权限管理
- **角色分级**  
  - **管理员**：负责系统配置、数据权限分配，执行分析任务，进行任务分配。
  - **烟技人员**：可查看任务信息，并提交反馈。
  - **烟农**：可查看任务信息，并提交反馈。
- **数据权限**  
  - 基于地块归属进行访问控制，确保不同用户只能访问其有权限的地块数据。


注意：不要混淆“监测任务”和“决策执行任务”
